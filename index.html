<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registration for WVSSM</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/css/tom-select.css" rel="stylesheet" />

  <style>
    .is-hidden { display: none !important; }

    .loading-spinner svg {
      width: 50px; height: 50px; stroke: #007bff;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .is-invalid {
      border-color: #dc3545 !important;
      background-color: #fff0f0;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container my-5">
    <div class="row justify-content-center">
      <div class="col-lg-6 col-md-8 col-sm-12">
        <div class="card shadow-sm">
          <div class="card-body">

            <div class="d-flex justify-content-center align-items-center mb-4 gap-2 flex-wrap">
              <div>
                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="none" stroke="#007bff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                  <circle cx="12" cy="7" r="4"/>
                  <path d="M5.5 21a6.5 6.5 0 0 1 13 0"/>
                </svg>
              </div>
              <div class="text-center">
                <h4 class="mb-1">Registration for WVSSM</h4>
                <small class="text-muted d-block">(Web-based Vaccination Supplies Stock Management)</small>
              </div>
            </div>

            <form name="submit-to-google-sheet" id="registrationForm">
              <div class="mb-3">
                <label for="idNumber" class="form-label">ID Number</label>
                <input type="text" class="form-control" id="idNumber" name="idNumber" required autocomplete="off">
              </div>

              <div class="mb-3">
                <label for="confirmIdNumber" class="form-label">Confirm ID Number</label>
                <input type="text" class="form-control" id="confirmIdNumber" required autocomplete="off" onpaste="return false;">
              </div>

              <div class="mb-3">
                <label for="firstName" class="form-label">First Name</label>
                <input type="text" class="form-control" id="firstName" name="firstName" required>
              </div>

              <div class="mb-3">
                <label for="lastName" class="form-label">Last Name</label>
                <input type="text" class="form-control" id="lastName" name="lastName" required>
              </div>

              <div class="mb-3">
                <label for="jobTitle" class="form-label">Job Title</label>
                <select id="jobTitle" name="jobTitle" placeholder="Select or type a job title..." autocomplete="off"></select>
              </div>

              <div class="mb-3">
                <label for="phone" class="form-label">Phone Number</label>
                <input type="tel" class="form-control" id="phone" name="phone" required autocomplete="off">
              </div>

              <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" name="email" required>
              </div>

              <div class="mb-3">
                <label for="confirmEmail" class="form-label">Confirm Email</label>
                <input type="email" class="form-control" id="confirmEmail" required onpaste="return false;">
              </div>

              <button type="submit" class="btn btn-primary w-100" id="submitBtn" disabled>Submit</button>
            </form>

            <div class="loading js-loading is-hidden text-center my-3">
              <div class="loading-spinner">
                <svg><circle cx="25" cy="25" r="20" fill="none" stroke-width="4" stroke-miterlimit="10"/></svg>
              </div>
            </div>

            <p class="js-success-message text-success text-center is-hidden">✅ Form submitted successfully!</p>
            <p class="js-error-message text-danger text-center is-hidden">❌ Submission failed. Please try again.</p>

          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/js/tom-select.complete.min.js"></script>

  <script>
    fetch('https://script.google.com/macros/s/AKfycbwDSXKAUOg-PR1FUqZNTNEU1vFpn4Letcp7KGxdJLfZxb1xNVQ7hun4NPWwQIa1WhZu/exec')
      .then(res => res.json())
      .then(jobTitles => {
        const options = jobTitles.map(title => ({ value: title, text: title }));
        new TomSelect('#jobTitle', {
          options: options,
          create: true,
          sortField: { field: "text", direction: "asc" }
        });
      })
      .catch(() => {
        new TomSelect('#jobTitle', { create: true });
      });

    const idInput = document.getElementById('idNumber');
    const confirmIdInput = document.getElementById('confirmIdNumber');
    const emailInput = document.getElementById('email');
    const confirmEmailInput = document.getElementById('confirmEmail');
    const submitBtn = document.getElementById('submitBtn');

    function validateConfirmations() {
      const idMatch = idInput.value === confirmIdInput.value;
      const emailMatch = emailInput.value === confirmEmailInput.value;

      confirmIdInput.classList.toggle('is-invalid', !idMatch);
      confirmEmailInput.classList.toggle('is-invalid', !emailMatch);

      submitBtn.disabled = !(idMatch && emailMatch);
    }

    [idInput, confirmIdInput, emailInput, confirmEmailInput].forEach(input =>
      input.addEventListener('input', validateConfirmations)
    );
  </script>

<script>
  const scriptURL = 'https://script.google.com/macros/s/AKfycbzBOMjfmGZ142ZJNbo5c8bQETF69_BTtaN6AR7kxC0brCJ1ZFkz1ByBPjUx1ws9bcC3/exec';
  const form = document.forms['submit-to-google-sheet'];
  const loading = document.querySelector('.js-loading');
  const successMessage = document.querySelector('.js-success-message');
  const errorMessage = document.querySelector('.js-error-message');

  form.addEventListener('submit', (e) => {
    e.preventDefault();

    form.classList.add('is-hidden');
    loading.classList.remove('is-hidden');

    fetch(scriptURL, {
      method: 'POST',
      body: new FormData(form)
    })
    .then(response => {
      loading.classList.add('is-hidden');
      successMessage.classList.remove('is-hidden');

      form.reset();
      validateConfirmations(); // Re-disable submit button

      setTimeout(() => {
        form.classList.remove('is-hidden');
        successMessage.classList.add('is-hidden');
      }, 3000);
    })
    .catch(error => {
      loading.classList.add('is-hidden');
      errorMessage.classList.remove('is-hidden');

      setTimeout(() => {
        form.classList.remove('is-hidden');
        errorMessage.classList.add('is-hidden');
      }, 3000);
    });
  });
</script>

</body>
</html>
